<!doctype html><html lang=zh-cn><head><title></title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.87ecd420aa4299c8e4b21123c5360ef38ce9d1370c88559d014914f4a65e6b89.css integrity="sha256-h+zUIKpCmcjkshEjxTYO84zp0TcMiFWdAUkU9KZea4k="><link rel=icon type=image/png href=/images/favicon_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_3.png><meta property="og:title" content><meta property="og:description" content="Redis #redis #中间件 #缓存 #db #内存缓存
基础数据类型 string list hash set zset bitmap 高级特性 #慢查询 #pipeline 多个命令一次请求减少网络开销
#事务 #Lua 原子操作
#Stream 底层原理 持久化 RDB save: 阻塞主线程 bgsave: 不阻塞主线程 AOF 分布式锁 setnx set lock_name 1 ex 10 nx 普通流程 加锁：set lock_name uuid ex 10 nx 业务操作 释放锁：lua 脚本，先 get 判断是否属于自己，再 del 释放锁 红锁流程 客户端获取当前时间戳T1 客户端依次向这 5 台 redis 实例（非集群）发起加锁请求 如果>=3个（大多数）成功，当前时间戳T2 - T1 < 锁的过期时间则加锁成功 加锁成功，操作业务 加锁失败/释放锁，向5台redis发起释放锁请求 集群 一主多从 主从 哨兵 多主多从 虚拟一致性哈希 -> 虚拟槽分区"><meta property="og:type" content="article"><meta property="og:url" content="https://ormissia.github.io/notes/my_notes/notes/%E8%AE%A1%E7%AE%97%E6%9C%BA/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/redis/"><meta property="article:section" content="notes"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Redis #redis #中间件 #缓存 #db #内存缓存
基础数据类型 string list hash set zset bitmap 高级特性 #慢查询 #pipeline 多个命令一次请求减少网络开销
#事务 #Lua 原子操作
#Stream 底层原理 持久化 RDB save: 阻塞主线程 bgsave: 不阻塞主线程 AOF 分布式锁 setnx set lock_name 1 ex 10 nx 普通流程 加锁：set lock_name uuid ex 10 nx 业务操作 释放锁：lua 脚本，先 get 判断是否属于自己，再 del 释放锁 红锁流程 客户端获取当前时间戳T1 客户端依次向这 5 台 redis 实例（非集群）发起加锁请求 如果>=3个（大多数）成功，当前时间戳T2 - T1 < 锁的过期时间则加锁成功 加锁成功，操作业务 加锁失败/释放锁，向5台redis发起释放锁请求 集群 一主多从 主从 哨兵 多主多从 虚拟一致性哈希 -> 虚拟槽分区"><script>theme=localStorage.getItem("darkmode:color-scheme")||"system",theme=="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-notes kind-page" data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/ormissia_hu763a76473558eea2a316ef50b45aaecf_966068_42x0_resize_box_3.png id=logo alt=Logo>
Ormissia's Blog</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-toggle=collapse data-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#home>主页</a></li><li class=nav-item><a class=nav-link href=/#about>技能</a></li><li class=nav-item><a class=nav-link href=/#recent-posts>最近</a></li><li class=nav-item><a class=nav-link href=/#education>历程</a></li><li class=nav-item><a class=nav-link href=/#projects>项目</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>更多的</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a class=dropdown-item href=/#achievements>成就</a></div></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>博文</a></li><li class=nav-item><a class=nav-link id=note-link href=/notes>笔记</a></li><li class=nav-item><a class=nav-link href=https://github.com/ormissia>GitHub</a></li></ul></div></div><img src=/images/ormissia_hu763a76473558eea2a316ef50b45aaecf_966068_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/ormissia_hu763a76473558eea2a316ef50b45aaecf_966068_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=搜索 data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/notes data-filter=all>笔记</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/> Go</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/basic/> Basics</a><ul><li><a class=list-link href=/notes/go/basic/basic/ title=Basic>Basic</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/advance/> Advance</a><ul><li><a class=list-link href=/notes/go/advance/time/ title=time>time</a></li><li><a class=list-link href=/notes/go/advance/gomod/ title="go mod">go mod</a></li><li><a class=list-link href=/notes/go/advance/chan/ title="go chan">go chan</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/algorithm/> Algorithm</a><ul><li><a class=list-link href=/notes/go/algorithm/basic/ title=Basic>Basic</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/java/> Java</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/java/basic/> Basics</a><ul><li><a class=list-link href=/notes/java/basic/basic_type/ title="Basic Types">Basic Types</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/scala/> Scala</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/scala/basic/> Basic</a><ul><li><a class=list-link href=/notes/scala/basic/basic_type/ title="Basic Types">Basic Types</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/python/> Python</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/python/basic/> Basic</a><ul><li><a class=list-link href=/notes/python/basic/basic/ title=Basic>Basic</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/js/> JavaScript</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/js/basic/> Basic</a><ul><li><a class=list-link href=/notes/js/basic/basic/ title=Basic>Basic</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/sql/> SQL</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/sql/dml/> DML</a><ul><li><a class=list-link href=/notes/sql/dml/dml/ title="SQL DML">SQL DML</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/linux/> Linux</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/linux/shell/> Shell</a><ul><li><a class=list-link href=/notes/linux/shell/basic/ title=Basic>Basic</a></li><li><a class=list-link href=/notes/linux/shell/advance/ title=Advance>Advance</a></li><li><a class=list-link href=/notes/linux/shell/vi/ title=vi>vi</a></li><li><a class=list-link href=/notes/linux/shell/script/ title=Script>Script</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/linux/system/> System</a><ul><li><a class=list-link href=/notes/linux/system/system/ title=Memory>Memory</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/hbase/> Hbase</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/hbase/shell/> Shell</a><ul><li><a class=list-link href=/notes/hbase/shell/basic/ title=Basic>Basic</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/kafka/> Kafka</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/kafka/shell/> Shell</a><ul><li><a class=list-link href=/notes/kafka/shell/basic/ title=Basic>Basic</a></li></ul></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class="content container-fluid" id=content><div class="container-fluid note-card-holder" id=note-card-holder><h1 id=redis>Redis</h1><p>#redis #中间件 #缓存 #db #内存缓存</p><h2 id=基础数据类型>基础数据类型</h2><ul><li>string</li><li>list</li><li>hash</li><li>set</li><li>zset</li><li>bitmap</li></ul><h2 id=高级特性>高级特性</h2><h3 id=慢查询>#慢查询</h3><h3 id=pipeline>#pipeline</h3><p>多个命令一次请求减少网络开销</p><h3 id=事务>#事务</h3><h3 id=lua>#Lua</h3><p>原子操作</p><h3 id=stream>#Stream</h3><h2 id=底层原理>底层原理</h2><h3 id=持久化>持久化</h3><h4 id=rdb>RDB</h4><ul><li>save: 阻塞主线程</li><li>bgsave: 不阻塞主线程</li></ul><h4 id=aof>AOF</h4><h3 id=分布式锁>分布式锁</h3><ul><li><code>setnx</code></li><li><code>set lock_name 1 ex 10 nx</code></li></ul><h4 id=普通流程>普通流程</h4><ol><li>加锁：<code>set lock_name uuid ex 10 nx</code></li><li>业务操作</li><li>释放锁：<code>lua</code> 脚本，先 <code>get</code> 判断是否属于自己，再 <code>del</code> 释放锁</li></ol><h4 id=红锁流程>红锁流程</h4><ol><li>客户端获取当前时间戳T1</li><li>客户端依次向这 5 台 <code>redis</code> 实例（非集群）发起加锁请求</li><li>如果>=3个（大多数）成功，当前时间戳T2 - T1 &lt; 锁的过期时间则加锁成功</li><li>加锁成功，操作业务</li><li>加锁失败/释放锁，向5台<code>redis</code>发起释放锁请求</li></ol><h2 id=集群>集群</h2><h3 id=一主多从>一主多从</h3><h4 id=主从>主从</h4><h4 id=哨兵>哨兵</h4><p><img src=%E8%AE%A1%E7%AE%97%E6%9C%BA/img/redis_sentry.png alt=哨兵></p><h3 id=多主多从>多主多从</h3><blockquote><p>虚拟一致性哈希 -> 虚拟槽分区</p></blockquote><h2 id=常见问题及解决办法>常见问题及解决办法</h2><h3 id=缓存相关>缓存相关</h3><ul><li>#缓存一致性<ul><li>成因：由于网络延迟等因素导致缓存中数据与DB中数据不一致</li><li>解决办法：#延时双删</li></ul></li><li>#缓存穿透<ul><li>成因：DB中不存在的数据被频繁请求</li><li>解决办法：1. 数据进行插入操作同时添加到 #布隆过滤器 ，2. 缓存空对象</li></ul></li><li>#缓存击穿<ul><li>成因：同一个缓存中不存在的 <code>key</code> ，在一段时间（一般是极短时间）内第一个请求查询完 DB 后还未写入缓存，导致这段时间内后续请求又直接打到 DB</li><li>解决办法：查询前加锁</li></ul></li><li>#缓存雪崩<ul><li>成因：大量缓存数据同时过期导致请求直接打到DB</li><li>解决办法：在一定范围内随机过期时间，比如一小时随机加减十以内分钟数</li></ul></li></ul><h3 id=key相关>key相关</h3><ul><li>#热点key<ul><li>解决办法：<ol><li>使用 <code>redis</code> 命令：容易造成 <code>redis</code> 宕机</li><li>#TCP抓包 ：<ul><li>无入侵性，成本高</li><li><code>elk-packetbeat</code></li><li>容易造成机器网络波动，如丢包</li><li>维护成本高</li></ul></li><li>二级缓存</li><li>主从架构时，在从节点中扫描大 key</li><li>子 key #hash算法</li></ol></li></ul></li><li>#大key<ul><li>大概标准：<ul><li><code>string</code> 大于 <code>10kb</code></li><li></li></ul></li></ul></li><li>#数据倾斜</li></ul><h2 id=链接>链接</h2><ul><li>[[计算机/项目/Go缓存垫片]]</li></ul></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>联系方式:</h5><ul><li><span>QQ: </span><span>1432050813</span></li><li><a href=mailto:ormissia@outlook.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>ormissia@outlook.com</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>免责声明:</strong> 老铁看到底了，要负责的哦</p></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.dd14ce5884a636a7014ae8dc2953b8089e2c54e6449da331e2726c712c81c910.js integrity="sha256-3RTOWISmNqcBSujcKVO4CJ4sVOZEnaMx4nJscSyByRA=" defer></script></body></html>