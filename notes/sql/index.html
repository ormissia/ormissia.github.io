<!doctype html><html lang=zh-cn><head><title>SQL Notes</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.6053c2440fb32ef2010c84f629a987aa593a9a7ff9a82643ef43d9bbe9096d92.css integrity="sha256-YFPCRA+zLvIBDIT2KamHqlk6mn/5qCZD70PZu+kJbZI="><link rel=icon type=image/png href=/images/favicon_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_3.png><meta property="og:url" content="https://ormissia.github.io/notes/sql/"><meta property="og:site_name" content="Ormissia's Blog"><meta property="og:title" content="SQL Notes"><meta property="og:description" content="SQL Notes "><meta property="og:locale" content="zh-cn"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="SQL Notes"><meta name=twitter:description content><script>theme=localStorage.getItem("darkmode:color-scheme")||"system",theme=="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-notes kind-section" data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/ormissia_hu763a76473558eea2a316ef50b45aaecf_966068_42x0_resize_box_3.png id=logo alt=Logo>
Ormissia's Blog</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-toggle=collapse data-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/#home>主页</a></li><li class=nav-item><a class=nav-link href=/#about>技能</a></li><li class=nav-item><a class=nav-link href=/#recent-posts>最近</a></li><li class=nav-item><a class=nav-link href=/#education>历程</a></li><li class=nav-item><a class=nav-link href=/#achievements>成就</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>博文</a></li><li class=nav-item><a class=nav-link id=note-link href=/notes>笔记</a></li><li class=nav-item><a class=nav-link href=https://github.com/ormissia>GitHub</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/ormissia_hu763a76473558eea2a316ef50b45aaecf_966068_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/ormissia_hu763a76473558eea2a316ef50b45aaecf_966068_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=搜索 data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/notes data-filter=all>笔记</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/> Go</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/basic/> Basics</a><ul><li><a class=list-link href=/notes/go/basic/basic/ title=Basic>Basic</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/advance/> Advance</a><ul><li><a class=list-link href=/notes/go/advance/time/ title=time>time</a></li><li><a class=list-link href=/notes/go/advance/gomod/ title="go mod">go mod</a></li><li><a class=list-link href=/notes/go/advance/chan/ title="go chan">go chan</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/go/algorithm/> Algorithm</a><ul><li><a class=list-link href=/notes/go/algorithm/basic/ title=Basic>Basic</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/java/> Java</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/java/basic/> Basics</a><ul><li><a class=list-link href=/notes/java/basic/basic_type/ title="Basic Types">Basic Types</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/scala/> Scala</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/scala/basic/> Basic</a><ul><li><a class=list-link href=/notes/scala/basic/basic_type/ title="Basic Types">Basic Types</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/python/> Python</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/python/basic/> Basic</a><ul><li><a class=list-link href=/notes/python/basic/basic/ title=Basic>Basic</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/js/> JavaScript</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/js/basic/> Basic</a><ul><li><a class=list-link href=/notes/js/basic/basic/ title=Basic>Basic</a></li></ul></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/notes/sql/> SQL</a><ul class=active><li><i data-feather=plus-circle></i><a class=list-link href=/notes/sql/dml/> DML</a><ul><li><a class=list-link href=/notes/sql/dml/dml/ title="SQL DML">SQL DML</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/linux/> Linux</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/linux/shell/> Shell</a><ul><li><a class=list-link href=/notes/linux/shell/basic/ title=Basic>Basic</a></li><li><a class=list-link href=/notes/linux/shell/advance/ title=Advance>Advance</a></li><li><a class=list-link href=/notes/linux/shell/vi/ title=vi>vi</a></li><li><a class=list-link href=/notes/linux/shell/script/ title=Script>Script</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/linux/system/> System</a><ul><li><a class=list-link href=/notes/linux/system/system/ title=Memory>Memory</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/hbase/> Hbase</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/hbase/shell/> Shell</a><ul><li><a class=list-link href=/notes/hbase/shell/basic/ title=Basic>Basic</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/notes/kafka/> Kafka</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/notes/kafka/shell/> Shell</a><ul><li><a class=list-link href=/notes/kafka/shell/basic/ title=Basic>Basic</a></li></ul></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class="content container-fluid" id=content><div class="container-fluid note-card-holder" id=note-card-holder><div class=note-card><div class=item><h5 class=note-title><span>按年月日分组聚合</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>group</span> <span style=color:#66d9ef>by</span> date_format(field_name, format);
</span></span></code></pre></div><p>根据<code>format</code>字符串格式化<code>date</code>值。下列修饰符可以被用在<code>format</code>字符串中：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>%M 月名字<span style=color:#f92672>(</span>January……December<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%W 星期名字<span style=color:#f92672>(</span>Sunday……Saturday<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%D 有英语前缀的月份的日期<span style=color:#f92672>(</span>1st, 2nd, 3rd, 等等。） 
</span></span><span style=display:flex><span>%Y 年, 数字, <span style=color:#ae81ff>4</span> 位 
</span></span><span style=display:flex><span>%y 年, 数字, <span style=color:#ae81ff>2</span> 位 
</span></span><span style=display:flex><span>%a 缩写的星期名字<span style=color:#f92672>(</span>Sun……Sat<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%d 月份中的天数, 数字<span style=color:#f92672>(</span>00……31<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%e 月份中的天数, 数字<span style=color:#f92672>(</span>0……31<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%m 月, 数字<span style=color:#f92672>(</span>01……12<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%c 月, 数字<span style=color:#f92672>(</span>1……12<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%b 缩写的月份名字<span style=color:#f92672>(</span>Jan……Dec<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%j 一年中的天数<span style=color:#f92672>(</span>001……366<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%H 小时<span style=color:#f92672>(</span>00……23<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%k 小时<span style=color:#f92672>(</span>0……23<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%h 小时<span style=color:#f92672>(</span>01……12<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%I 小时<span style=color:#f92672>(</span>01……12<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%l 小时<span style=color:#f92672>(</span>1……12<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%i 分钟, 数字<span style=color:#f92672>(</span>00……59<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%r 时间,12 小时<span style=color:#f92672>(</span>hh:mm:ss <span style=color:#f92672>[</span>AP<span style=color:#f92672>]</span>M<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%T 时间,24 小时<span style=color:#f92672>(</span>hh:mm:ss<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%S 秒<span style=color:#f92672>(</span>00……59<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%s 秒<span style=color:#f92672>(</span>00……59<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>%p AM或PM 
</span></span><span style=display:flex><span>%w 一个星期中的天数<span style=color:#f92672>(</span>0<span style=color:#f92672>=</span>Sunday ……6<span style=color:#f92672>=</span>Saturday ） 
</span></span><span style=display:flex><span>%U 星期<span style=color:#f92672>(</span>0……52<span style=color:#f92672>)</span>, 这里星期天是星期的第一天 
</span></span><span style=display:flex><span>%u 星期<span style=color:#f92672>(</span>0……52<span style=color:#f92672>)</span>, 这里星期一是星期的第一天 
</span></span><span style=display:flex><span>%% 一个文字“%”
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>count统计不重复个数</span></h5><div class=card><div class=card-body><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#66d9ef>count</span>(<span style=color:#66d9ef>distinct</span> (field_name))
</span></span><span style=display:flex><span><span style=color:#66d9ef>from</span> <span style=color:#66d9ef>table_name</span>
</span></span></code></pre></div></div></div></div></div><div class=note-card><div class=item><h5 class=note-title><span>sum结果为null时置为0</span></h5><div class=card><div class=card-body><p>SQL中使用<code>sum</code>统计总数时:<code>sum(col_name)</code>，如果某列不符合<code>sum</code>的条件（比如某列中含有NULL元素，或者不是数值类型，或者没有符合<code>where</code>条件的行），那么会返回NULL
有的时候不希望sum的结果为<code>NULL</code>，可以做如下的处理：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> COALESCE(<span style=color:#66d9ef>sum</span>(col_name), <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>Table</span>
</span></span></code></pre></div><p>此外还有<code>ISNULL(SQL Server)</code>，<code>NVL(Oracle)</code>以及<code>IFNULL(MySQL)</code>的用法，起到同样的效果</p></div></div></div></div></div><div class=paginator></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>联系方式:</h5><ul><li><span>QQ: </span><span>1432050813</span></li><li><a href=mailto:ormissia@outlook.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>ormissia@outlook.com</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>免责声明:</strong> 老铁看到底了，要负责的哦</p></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.9b160931dcd3fa8af9786eb07a3a6a6cd3a6e42a3327cdbe4880b17fe3f1450c.js integrity="sha256-mxYJMdzT+or5eG6wejpqbNOm5CozJ82+SICxf+PxRQw=" defer></script></body></html>