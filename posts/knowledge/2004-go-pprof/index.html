<!doctype html><html>
<head>
<title>Golang性能分析工具-pprof</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<link rel=stylesheet href=/css/bootstrap.min.css>
<link rel=stylesheet href=/css/layouts/main.css>
<link rel=stylesheet href=/css/navigators/navbar.css>
<link rel=stylesheet href=/css/plyr.css>
<link rel=stylesheet href=/css/flag-icon.min.css>
<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css>
<link rel=icon type=image/png href=/images/favicon_hu8376fd15465fef26ffe66b6bcf0ca686_13669_42x0_resize_box_3.png>
<meta property="og:title" content="Golang性能分析工具-pprof">
<meta property="og:description" content="pprof is a tool for visualization and analysis of profiling data.
  pprof reads a collection of profiling samples in profile.proto format and generates reports to visualize and help analyze the data. It can generate both text and graphical reports (through the use of the dot visualization package).
  PProf是用于可视化和分析性能分析数据的工具，PProf以profile.proto读取分析样本的集合，并生成报告以可视化并帮助分析数据（支持文本和图形报告）。
 简介 采集方式  runtime/pprof：采集程序（非Server）的指定区块的运行数据进行分析。 net/http/pprof：基于HTTPServer运行，并且可以采集运行时数据进行分析。 gotest：通过运行测试用例，并指定所需标识来进行采集。  功能  CPUProfiling：CPU分析，按照一定的频率采集所监听的应用程序CPU（含寄存器）的使用情况，可确定应用程序在主动消耗CPU周期时花费时间的位置。 MemoryProfiling：内存分析，在应用程序进行堆分配时记录堆栈跟踪，用于监视当前和历史内存使用情况，以及检查内存泄漏。 BlockProfiling：阻塞分析，记录Goroutine阻塞等待同步（包括定时器通道）的位置，默认不开启，需要调用runtime.SetBlockProfileRate进行设置。 MutexProfiling：互斥锁分析，报告互斥锁的竞争情况，默认不开启，需要调用runtime.SetMutexProfileFraction进行设置。 GoroutineProfiling：Goroutine分析，可以对当前应用程序正在运行的Goroutine进行堆栈跟踪和分析。这项功能在实际排查中会经常用到， 因为很多问题出现时的表象就是Goroutine暴增，而这时候我们要做的事情之一就是查看应用程序中的Goroutine正在做什么事情，因为什么阻塞了， 然后再进行下一步。  简单的例子 注意要在import中引入 _ &#34;net/http/pprof&#34;">
<meta property="og:type" content="article">
<meta property="og:url" content="https://ormissia.github.io/posts/knowledge/2004-go-pprof/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-08-05T18:45:47+08:00">
<meta property="article:modified_time" content="2021-08-05T18:45:47+08:00">
<meta name=description content="Golang性能分析工具-pprof">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css>
<link rel=stylesheet href=/css/layouts/single.css>
<link rel=stylesheet href=/css/navigators/sidebar.css>
<link rel=stylesheet href=/css/style.css>
</head>
<body data-spy=scroll data-target=#TableOfContents data-offset=80>
<div class="container-fluid bg-dimmed wrapper">
<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
<div class=container>
<button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span>
</button>
<a class=navbar-brand href=/>
<img src=/images/ormissia_hu763a76473558eea2a316ef50b45aaecf_966068_42x0_resize_box_3.png alt=Logo>
Ormissia's Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse lang-selector" id=top-nav-items>
<ul class="navbar-nav ml-auto">
</ul>
</div>
</div>
<img src=/images/ormissia_hu763a76473558eea2a316ef50b45aaecf_966068_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/ormissia_hu763a76473558eea2a316ef50b45aaecf_966068_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo">
</nav>
<section class=sidebar-section id=sidebar-section>
<div class=sidebar-holder>
<div class=sidebar id=sidebar>
<form class=mx-auto method=get action=/search>
<input type=text name=keyword placeholder=Search data-search id=search-box>
</form>
<div class=sidebar-tree>
<ul class=tree id=tree>
<li id=list-heading><a href=/posts data-filter=all>博文</a></li>
<div class=subtree>
<li>
<i class="fas fa-minus-circle"></i><a class=active href=/posts/knowledge/>知识积累</a>
<ul class=active>
<li><a href=/posts/knowledge/2001-go-partten-1/ title=函数选项模式>函数选项模式</a></li>
<li><a href=/posts/knowledge/2002-go-param-verify/ title=实体参数校验>实体参数校验</a></li>
<li><a href=/posts/knowledge/2003-go-reflect/ title=Golang反射>Golang反射</a></li>
<li><a class=active href=/posts/knowledge/2004-go-pprof/ title=pprof>pprof</a></li>
<li><a href=/posts/knowledge/2005-go-tag/ title="Golang struct tag">Golang struct tag</a></li>
<li><a href=/posts/knowledge/2006-hadoop-env/ title=Hadoop生态组件>Hadoop生态组件</a></li>
<li><a href=/posts/knowledge/2007-hadoop-hdfs/ title=HDFS基础知识>HDFS基础知识</a></li>
<li><a href=/posts/knowledge/2008-elasticstack-es/ title=Elasticsearch>Elasticsearch</a></li>
<li><a href=/posts/knowledge/2009-kubernetes-handless-statefullset/ title=k8s中通过Headless连接StatefulSet>k8s中通过Headless连接StatefulSet</a></li>
</ul>
</li>
<li>
<i class="fas fa-plus-circle"></i><a href=/posts/deployment/>环境部署</a>
<ul>
<li><a href=/posts/deployment/3001-blog-cicd/ title=我的博客后端Docker镜像打包自动部署流程>我的博客后端Docker镜像打包自动部署流程</a></li>
<li><a href=/posts/deployment/3002-linux-nginx/ title=Linux部署Nginx流程>Linux部署Nginx流程</a></li>
<li><a href=/posts/deployment/3003-linux-traefik/ title=Traefik部署流程>Traefik部署流程</a></li>
<li><a href=/posts/deployment/3004-linux-grafana/ title=Grafana部署流程>Grafana部署流程</a></li>
<li><a href=/posts/deployment/3005-linux-prometheus/ title=Prometheus部署流程>Prometheus部署流程</a></li>
<li><a href=/posts/deployment/3006-linux-elk/ title=ELK部署流程>ELK部署流程</a></li>
<li><a href=/posts/deployment/3007-linux-kubernetes/ title=Linux部署Kubernetes流程>Linux部署Kubernetes流程</a></li>
</ul>
</li>
<li>
<i class="fas fa-plus-circle"></i><a href=/posts/algorithm/>算法</a>
<ul>
<li><a href=/posts/algorithm/4001-algorithm-sort/ title=排序算法>排序算法</a></li>
<li><a href=/posts/algorithm/4002-algorithm-trie/ title=前缀树>前缀树</a></li>
</ul>
</li>
<li>
<i class="fas fa-plus-circle"></i><a href=/posts/problems/>疑难杂症</a>
<ul>
<li><a href=/posts/problems/5001-go-online-service-oom/ title=记一次线上的内存持续增长问题>记一次线上的内存持续增长问题</a></li>
<li><a href=/posts/problems/5002-k8s-memory/ title=Grafana上监控不准问题排查>Grafana上监控不准问题排查</a></li>
<li><a href=/posts/problems/5003-elasticsearch-start-failed/ title=CentOS安装完ES无法启动>CentOS安装完ES无法启动</a></li>
<li><a href=/posts/problems/5004-kubernetes-dashboard-token/ title="k8s dashboard token过期时间太短">k8s dashboard token过期时间太短</a></li>
<li><a href=/posts/problems/5005-docker-image-source/ title=修改Docker镜像源>修改Docker镜像源</a></li>
</ul>
</li>
<li>
<i class="fas fa-plus-circle"></i><a href=/posts/unclassified/>未分类</a>
<ul>
<li><a href=/posts/unclassified/6001-markdown/ title="Markdown Sample">Markdown Sample</a></li>
</ul>
</li>
</div>
</ul>
</div>
</div>
</div>
</section>
<section class=content-section id=content-section>
<div class=content>
<div class="container p-0 read-area">
<div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://ormissia.github.io/posts/knowledge/2004-go-pprof/head.svg)>
</div>
<div class=page-content>
<div class="author-profile ml-auto align-self-lg-center">
<img class=rounded-circle src=/images/avatar_hu6760e73bd186896e9f58f2b8b663dec5_93204_120x120_fit_box_3.png alt="Author Image">
<h5 class=author-name>Ormissia</h5>
<p>August 5, 2021</p>
</div>
<div class=title>
<h1>Golang性能分析工具-pprof</h1>
</div>
<div class=post-content id=post-content>
<hr>
<p><img src=https://img.shields.io/badge/-Golang-blue alt=Golang>
<img src=https://img.shields.io/badge/-pprof-green alt=pprof>
<img src=https://img.shields.io/badge/-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7-red alt=性能监控></p>
<hr>
<blockquote>
<p>pprof is a tool for visualization and analysis of profiling data.</p>
</blockquote>
<blockquote>
<p>pprof reads a collection of profiling samples in profile.proto format and generates reports to visualize and
help analyze the data. It can generate both text and graphical reports (through the use of the dot visualization package).</p>
</blockquote>
<blockquote>
<p><code>PProf</code>是用于可视化和分析性能分析数据的工具，<code>PProf</code>以<code>profile.proto</code>读取分析样本的集合，并生成报告以可视化并帮助分析数据（支持文本和图形报告）。</p>
</blockquote>
<h2 id=简介>简介</h2>
<h3 id=采集方式>采集方式</h3>
<ul>
<li><code>runtime/pprof</code>：采集程序（非<code>Server</code>）的指定区块的运行数据进行分析。</li>
<li><code>net/http/pprof</code>：基于HTTPServer运行，并且可以采集运行时数据进行分析。</li>
<li><code>gotest</code>：通过运行测试用例，并指定所需标识来进行采集。</li>
</ul>
<h3 id=功能>功能</h3>
<ul>
<li>CPUProfiling：CPU分析，按照一定的频率采集所监听的应用程序CPU（含寄存器）的使用情况，可确定应用程序在主动消耗CPU周期时花费时间的位置。</li>
<li>MemoryProfiling：内存分析，在应用程序进行堆分配时记录堆栈跟踪，用于监视当前和历史内存使用情况，以及检查内存泄漏。</li>
<li>BlockProfiling：阻塞分析，记录<code>Goroutine</code>阻塞等待同步（包括定时器通道）的位置，默认不开启，需要调用<code>runtime.SetBlockProfileRate</code>进行设置。</li>
<li>MutexProfiling：互斥锁分析，报告互斥锁的竞争情况，默认不开启，需要调用<code>runtime.SetMutexProfileFraction</code>进行设置。</li>
<li>GoroutineProfiling：<code>Goroutine</code>分析，可以对当前应用程序正在运行的<code>Goroutine</code>进行堆栈跟踪和分析。这项功能在实际排查中会经常用到，
因为很多问题出现时的表象就是<code>Goroutine</code>暴增，而这时候我们要做的事情之一就是查看应用程序中的<code>Goroutine</code>正在做什么事情，因为什么阻塞了，
然后再进行下一步。</li>
</ul>
<h2 id=简单的例子>简单的例子</h2>
<p>注意要在<code>import</code>中引入 <code>_ "net/http/pprof"</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> (
	<span style=color:#e6db74>&#34;log&#34;</span>
	<span style=color:#e6db74>&#34;net/http&#34;</span>
	<span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;net/http/pprof&#34;</span>
	<span style=color:#e6db74>&#34;time&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
		<span style=color:#66d9ef>for</span> {
			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;pprof&#34;</span>)
			<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
		}
	}()

	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;0.0.0.0:6060&#34;</span>, <span style=color:#66d9ef>nil</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
		<span style=color:#66d9ef>return</span>
	}
}
</code></pre></div><h3 id=通过web页面访问>通过web页面访问</h3>
<p>运行之后打开页面<a href=http://127.0.0.1:6060/debug/pprof/>http://127.0.0.1:6060/debug/pprof/</a></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>/</span><span style=color:#a6e22e>debug</span><span style=color:#f92672>/</span><span style=color:#a6e22e>pprof</span><span style=color:#f92672>/</span>

<span style=color:#a6e22e>Types</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>profiles</span> <span style=color:#a6e22e>available</span>:
<span style=color:#a6e22e>Count</span>	<span style=color:#a6e22e>Profile</span>
<span style=color:#ae81ff>0</span>	<span style=color:#a6e22e>allocs</span>
<span style=color:#ae81ff>0</span>	<span style=color:#a6e22e>block</span>
<span style=color:#ae81ff>0</span>	<span style=color:#a6e22e>cmdline</span>
<span style=color:#ae81ff>5</span>	<span style=color:#a6e22e>goroutine</span>
<span style=color:#ae81ff>0</span>	<span style=color:#a6e22e>heap</span>
<span style=color:#ae81ff>0</span>	<span style=color:#a6e22e>mutex</span>
<span style=color:#ae81ff>0</span>	<span style=color:#a6e22e>profile</span>
<span style=color:#ae81ff>7</span>	<span style=color:#a6e22e>threadcreate</span>
<span style=color:#ae81ff>0</span>	<span style=color:#a6e22e>trace</span>
<span style=color:#a6e22e>full</span> <span style=color:#a6e22e>goroutine</span> <span style=color:#a6e22e>stack</span> <span style=color:#a6e22e>dump</span>
<span style=color:#a6e22e>Profile</span> <span style=color:#a6e22e>Descriptions</span>:

<span style=color:#a6e22e>allocs</span>: <span style=color:#a6e22e>A</span> <span style=color:#a6e22e>sampling</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>all</span> <span style=color:#a6e22e>past</span> <span style=color:#a6e22e>memory</span> <span style=color:#a6e22e>allocations</span>
<span style=color:#a6e22e>block</span>: <span style=color:#a6e22e>Stack</span> <span style=color:#a6e22e>traces</span> <span style=color:#a6e22e>that</span> <span style=color:#a6e22e>led</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>blocking</span> <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>synchronization</span> <span style=color:#a6e22e>primitives</span>
<span style=color:#a6e22e>cmdline</span>: <span style=color:#a6e22e>The</span> <span style=color:#a6e22e>command</span> <span style=color:#a6e22e>line</span> <span style=color:#a6e22e>invocation</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>current</span> <span style=color:#a6e22e>program</span>
<span style=color:#a6e22e>goroutine</span>: <span style=color:#a6e22e>Stack</span> <span style=color:#a6e22e>traces</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>all</span> <span style=color:#a6e22e>current</span> <span style=color:#a6e22e>goroutines</span>
<span style=color:#a6e22e>heap</span>: <span style=color:#a6e22e>A</span> <span style=color:#a6e22e>sampling</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>memory</span> <span style=color:#a6e22e>allocations</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>live</span> <span style=color:#a6e22e>objects</span>. <span style=color:#a6e22e>You</span> <span style=color:#a6e22e>can</span> <span style=color:#a6e22e>specify</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>gc</span> <span style=color:#a6e22e>GET</span> <span style=color:#a6e22e>parameter</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>run</span> <span style=color:#a6e22e>GC</span> <span style=color:#a6e22e>before</span> <span style=color:#a6e22e>taking</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>heap</span> <span style=color:#a6e22e>sample</span>.
<span style=color:#a6e22e>mutex</span>: <span style=color:#a6e22e>Stack</span> <span style=color:#a6e22e>traces</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>holders</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>contended</span> <span style=color:#a6e22e>mutexes</span>
<span style=color:#a6e22e>profile</span>: <span style=color:#a6e22e>CPU</span> <span style=color:#a6e22e>profile</span>. <span style=color:#a6e22e>You</span> <span style=color:#a6e22e>can</span> <span style=color:#a6e22e>specify</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>duration</span> <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>seconds</span> <span style=color:#a6e22e>GET</span> <span style=color:#a6e22e>parameter</span>. <span style=color:#a6e22e>After</span> <span style=color:#a6e22e>you</span> <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>profile</span> <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>use</span> <span style=color:#a6e22e>the</span> <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>tool</span> <span style=color:#a6e22e>pprof</span> <span style=color:#a6e22e>command</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>investigate</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>profile</span>.
<span style=color:#a6e22e>threadcreate</span>: <span style=color:#a6e22e>Stack</span> <span style=color:#a6e22e>traces</span> <span style=color:#a6e22e>that</span> <span style=color:#a6e22e>led</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>creation</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>new</span> <span style=color:#a6e22e>OS</span> <span style=color:#a6e22e>threads</span>
<span style=color:#a6e22e>trace</span>: <span style=color:#a6e22e>A</span> <span style=color:#a6e22e>trace</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>execution</span> <span style=color:#a6e22e>of</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>current</span> <span style=color:#a6e22e>program</span>. <span style=color:#a6e22e>You</span> <span style=color:#a6e22e>can</span> <span style=color:#a6e22e>specify</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>duration</span> <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>seconds</span> <span style=color:#a6e22e>GET</span> <span style=color:#a6e22e>parameter</span>. <span style=color:#a6e22e>After</span> <span style=color:#a6e22e>you</span> <span style=color:#a6e22e>get</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>trace</span> <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>use</span> <span style=color:#a6e22e>the</span> <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>tool</span> <span style=color:#a6e22e>trace</span> <span style=color:#a6e22e>command</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>investigate</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>trace</span>.
</code></pre></div><h3 id=通过终端访问>通过终端访问</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>go tool pprof http://localhost:6060/debug/pprof/profile<span style=color:#ae81ff>\?</span>seconds<span style=color:#ae81ff>\=</span><span style=color:#ae81ff>60</span>
</code></pre></div><p>执行该命令后，需等待60秒（可调整<code>seconds</code>的值），<code>pprof</code>会进行<code>CPU Profiling</code>。结束后将默认进入<code>pprof</code>的交互式命令模式，
可以对分析的结果进行查看或导出。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Fetching profile over HTTP from http://localhost:6060/debug/pprof/profile?seconds<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>
Saved profile in /Users/orimissia/pprof/pprof.samples.cpu.003.pb.gz
Type: cpu
Time: Aug 6, <span style=color:#ae81ff>2021</span> at 2:41pm <span style=color:#f92672>(</span>CST<span style=color:#f92672>)</span>
Duration: 1mins, Total samples <span style=color:#f92672>=</span> 10ms <span style=color:#f92672>(</span>0.017%<span style=color:#f92672>)</span>
Entering interactive mode <span style=color:#f92672>(</span>type <span style=color:#e6db74>&#34;help&#34;</span> <span style=color:#66d9ef>for</span> commands, <span style=color:#e6db74>&#34;o&#34;</span> <span style=color:#66d9ef>for</span> options<span style=color:#f92672>)</span>
<span style=color:#f92672>(</span>pprof<span style=color:#f92672>)</span> 
</code></pre></div><p>具体可执行<code>pprof help</code>查看命令说明</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#f92672>(</span>pprof<span style=color:#f92672>)</span> top10
Showing nodes accounting <span style=color:#66d9ef>for</span> 10ms, 100% of 10ms total
      flat  flat%   sum%        cum   cum%
      10ms   100%   100%       10ms   100%  runtime.kevent
         <span style=color:#ae81ff>0</span>     0%   100%       10ms   100%  runtime.findrunnable
         <span style=color:#ae81ff>0</span>     0%   100%       10ms   100%  runtime.mcall
         <span style=color:#ae81ff>0</span>     0%   100%       10ms   100%  runtime.netpoll
         <span style=color:#ae81ff>0</span>     0%   100%       10ms   100%  runtime.park_m
         <span style=color:#ae81ff>0</span>     0%   100%       10ms   100%  runtime.schedule
</code></pre></div><ul>
<li>flat：给定函数上运行耗时</li>
<li>flat%：同上的CPU运行耗时总比例</li>
<li>sum%：给定函数累积使用CPU总比例</li>
<li>cum：当前函数加上它之上的调用运行总耗时</li>
<li>cum%：同上的CPU运行耗时总比例</li>
</ul>
<blockquote>
<p>最后一列为函数名称，在大多数的情况下，我们可以通过这五列得出一个应用程序的运行情况，加以优化。</p>
</blockquote>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>go tool pprof http://localhost:6060/debug/pprof/heap
</code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>Saved profile in /Users/orimissia/pprof/pprof.alloc_objects.alloc_space.inuse_objects.inuse_space.001.pb.gz
Type: inuse_space
Time: Aug 6, <span style=color:#ae81ff>2021</span> at 2:46pm <span style=color:#f92672>(</span>CST<span style=color:#f92672>)</span>
No samples were found with the default sample value type.
Try <span style=color:#e6db74>&#34;sample_index&#34;</span> command to analyze different sample values.
Entering interactive mode <span style=color:#f92672>(</span>type <span style=color:#e6db74>&#34;help&#34;</span> <span style=color:#66d9ef>for</span> commands, <span style=color:#e6db74>&#34;o&#34;</span> <span style=color:#66d9ef>for</span> options<span style=color:#f92672>)</span>
</code></pre></div><ul>
<li>-inuse_space：分析应用程序的常驻内存占用情况</li>
<li>-alloc_objects：分析应用程序的内存临时分配情况</li>
</ul>
<h3 id=可视化界面>可视化界面</h3>
<p>新建测试用例：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>

<span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;testing&#34;</span>

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>str</span> = <span style=color:#e6db74>&#34;ormissia&#34;</span>

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAdd</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Con</span>(<span style=color:#a6e22e>str</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Test.Add error!&#34;</span>)
	}
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>BenchmarkAdd</span>(<span style=color:#a6e22e>b</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>B</span>) {
	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>N</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
		<span style=color:#a6e22e>Con</span>(<span style=color:#a6e22e>str</span>)
	}
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Con</span>(<span style=color:#a6e22e>str</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
	<span style=color:#a6e22e>data</span> <span style=color:#f92672>:=</span> []byte(<span style=color:#a6e22e>str</span>)
	<span style=color:#a6e22e>sData</span> <span style=color:#f92672>:=</span> string(<span style=color:#a6e22e>data</span>)
	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>sData</span>
}
</code></pre></div><p>执行测试用例</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>% go test -bench<span style=color:#f92672>=</span>. -cpuprofile<span style=color:#f92672>=</span>cpu.prof
goos: darwin
goarch: arm64
pkg: awesomeProject/pprof
BenchmarkAdd-8          <span style=color:#ae81ff>182690547</span>                6.330 ns/op
PASS
ok      awesomeProject/pprof    2.366s
</code></pre></div><p>启动<code>pprof</code>可视化界面</p>
<p>方法一</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>go tool pprof -http<span style=color:#f92672>=</span>:8080 cpu.prof
</code></pre></div><p>方法二</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>go tool pprof cpu.prof 
<span style=color:#f92672>(</span>pprof<span style=color:#f92672>)</span> web
</code></pre></div><p>可视化界面</p>
<p><img src=pprof-index.png alt=pprof-index></p>
<h2 id=参考>参考</h2>
<ul>
<li><a href=https://github.com/google/pprof>https://github.com/google/pprof</a></li>
<li><a href=https://golang2.eddycjy.com/posts/ch6/01-pprof-1/>https://golang2.eddycjy.com/posts/ch6/01-pprof-1</a></li>
</ul>
</div>
<div class="row pl-3 pr-3">
<div class="col-md-6 share-buttons">
<strong>分享:</strong>
<a class="btn btn-sm reddit-btn" href="https://reddit.com/submit?url=https%3a%2f%2formissia.github.io%2fposts%2fknowledge%2f2004-go-pprof%2f&title=Golang%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e5%b7%a5%e5%85%b7-pprof" target=_blank>
<i class="fab fa-reddit"></i>
</a>
<a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2formissia.github.io%2fposts%2fknowledge%2f2004-go-pprof%2f&title=Golang%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e5%b7%a5%e5%85%b7-pprof" target=_blank>
<i class="fab fa-linkedin"></i>
</a>
<a class="btn btn-sm email-btn" href="mailto:?subject=Golang%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e5%b7%a5%e5%85%b7-pprof&body=https%3a%2f%2formissia.github.io%2fposts%2fknowledge%2f2004-go-pprof%2f" target=_blank>
<i class="fas fa-envelope-open-text"></i>
</a>
</div>
<div class="col-md-6 btn-improve-page">
<a href=https://github.com/ormissia/ormissia.github.io/edit/master/content/posts/knowledge/2004-go-pprof/index.md title=改善此页面 target=_blank rel=noopener>
<i class="fas fa-code-branch"></i>
改善此页面
</a>
</div>
</div>
<hr>
<div class="row next-prev-navigator">
<div class="col-md-6 previous-article">
<a href=/posts/knowledge/2003-go-reflect/ title=Golang反射 class="btn btn-outline-info">
<div><i class="fas fa-chevron-circle-left"></i> 上一篇</div>
<div class=next-prev-text>Golang反射</div>
</a>
</div>
<div class="col-md-6 next-article">
<a href=/posts/knowledge/2005-go-tag/ title="Golang struct tag浅析与自定义tag实践" class="btn btn-outline-info">
<div>下一篇 <i class="fas fa-chevron-circle-right"></i></div>
<div class=next-prev-text>Golang struct tag浅析与自定义tag实践</div>
</a>
</div>
</div>
<hr>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement("script"),a.type="text/javascript",a.async=!0,b="ormissia-github-io-posts",a.src="//"+b+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)})()</script>
<noscript>请启用 JavaScript 以查看
<a href=https://disqus.com/?ref_noscript>评论支持 by Disqus.</a></noscript>
<a href=https://disqus.com/ class=dsq-brlink>评论支持 by <span class=logo-disqus>Disqus</span></a>
</div>
</div>
</div>
<a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a>
</section>
<section class=toc-section id=toc-section>
<div class=toc-holder>
<h5 class="text-center pl-3">目录</h5>
<hr>
<div class=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#简介>简介</a>
<ul>
<li><a href=#采集方式>采集方式</a></li>
<li><a href=#功能>功能</a></li>
</ul>
</li>
<li><a href=#简单的例子>简单的例子</a>
<ul>
<li><a href=#通过web页面访问>通过web页面访问</a></li>
<li><a href=#通过终端访问>通过终端访问</a></li>
<li><a href=#可视化界面>可视化界面</a></li>
</ul>
</li>
<li><a href=#参考>参考</a></li>
</ul>
</nav>
</div>
</div>
</section>
</div>
<footer class="container-fluid text-center align-content-center footer pb-2">
<div class="container pt-5">
<div class="row text-left">
<div class="col-md-4 col-sm-12">
<h5>联系方式:</h5>
<ul>
<li><span>QQ: </span> <span>1432050813</span></li>
<li><span>Email: </span> <span>ormissia@outlook.com</span></li>
</ul>
</div>
</div>
</div>
<hr>
<div class=container>
<p id=disclaimer><strong>免责声明:</strong> 老铁看到底了，要负责的哦</p>
</div>
<hr>
<div class=container>
<div class="row text-left">
<div class=col-md-4>
<a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener>
<img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha
</a>
</div>
<div class="col-md-4 text-center">© 2021 Copyright.</div>
<div class="col-md-4 text-right">
<a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18>
</a>
</div>
</div>
</div>
</footer>
<script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>